<%- include("../partials/authUpper.ejs") %>
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-3 col-md-3 col-sm-12">
                <div class="col-lg-12 col-md-12 col-sm-12">
                    <div class="card mycard">
                        <div class="card-body">
                            <h5 class="card-title mybluecolor text-center">Student Invitation Code</h5>
                            <h6 class="card-subtitle mb-2 text-muted">
                                <hr>
                            </h6>
                            <div class="row">
                                <div class="col align-self-center text-center">
                                    <h6 class="myorangecolor text-center" id="invititation-code"></h6>
                                </div>
                                <div class="col align-self-center text-center"></div>
                                <div class="col align-self-end">
                                    <form action="/refresh-student-invitation-code" method="post">
                                        <button type="submit" class="btn btn-danger btn-end" data-bs-toggle="tooltip"
                                            data-bs-placement="left" title="Refresh Code">
                                            <i class="fas fa-sync-alt"></i></button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-12 col-md-12 col-sm-12">
                    <div class="card mycard">
                        <div class="card-body">
                            <h5 class="card-title mybluecolor text-center">Get Student List</h5>
                            <h6 class="card-subtitle mb-2 text-muted">
                                <hr>
                            </h6>
                            <form action="/find-students" class="form-horizontal" method="post">
                                <label for="class" class="form-label">Class</label>
                                <select class="form-select mb-3" id="class" name="class">
                                    <!-- <option value="" selected disabled>Class</option> -->
                                    <optgroup label="School">
                                        <option value="1">1</option>
                                        <option value="2">2</option>
                                        <option value="3">3</option>
                                        <option value="4">4</option>
                                        <option value="5">5</option>
                                        <option value="6">6</option>
                                        <option value="7">7</option>
                                        <option value="8">8</option>
                                        <option value="9">9</option>
                                        <option value="10">10</option>
                                        <option value="11">11</option>
                                        <option value="12">12</option>
                                    </optgroup>
                                    <optgroup label="Graduation">
                                        <option value="GY1">Graduation 1st Year</option>
                                        <option value="GY1S1">Graduation 1st Year 1st Semester</option>
                                        <option value="GY1S2">Graduation 1st Year 2nd Semester</option>
                                        <option value="GY2">Graduation 2nd Year</option>
                                        <option value="GY2S1">Graduation 2nd Year 1st Semester</option>
                                        <option value="GY2S2">Graduation 2nd Year 2nd Semester</option>
                                        <option value="GY3">Graduation 3rd Year</option>
                                        <option value="GY3S1">Graduation 3rd Year 1st Semester</option>
                                        <option value="GY3S2">Graduation 3rd Year 2nd Semester</option>
                                        <option value="GY4">Graduation 4th Year</option>
                                        <option value="GY4S1">Graduation 4th Year 1st Semester</option>
                                        <option value="GY4S2">Graduation 4th Year 2nd Semester</option>
                                        <option value="GY5">Graduation 5th Year</option>
                                        <option value="GY5S1">Graduation 5th Year 1st Semester</option>
                                        <option value="GY5S2">Graduation 5th Year 2nd Semester</option>
                                    </optgroup>
                                    <optgroup label="Post Graduation">
                                        <option value="PGY1">PG 1st Year</option>
                                        <option value="PGY1S1">PG 1st Year 1st Semester</option>
                                        <option value="PGY1S2">PG 1st Year 2nd Semester</option>
                                        <option value="PGY2">PG 2nd Year</option>
                                        <option value="PGY2S1">PG 2nd Year 1st Semester</option>
                                        <option value="PGY2S2">PG 2nd Year 2nd Semester</option>
                                        <option value="PGY3">PG 3rd Year</option>
                                        <option value="PGY3S1">PG 3rd Year 1st Semester</option>
                                        <option value="PGY3S2">PG 3rd Year 2nd Semester</option>
                                    </optgroup>
                                </select>
                                <label for="class" class="form-label">Section</label>
                                <select class="form-select mb-3" id="section" name="section">
                                    <!-- <option value="" selected disabled>Section</option> -->
                                    <option value="A">A</option>
                                    <option value="B">B</option>
                                    <option value="C">C</option>
                                    <option value="D">D</option>
                                    <option value="E">E</option>
                                    <option value="F">F</option>
                                    <option value="G">G</option>
                                    <option value="H">H</option>
                                    <option value="I">I</option>
                                    <option value="J">J</option>
                                    <option value="K">K</option>
                                    <option value="L">L</option>
                                    <option value="M">M</option>
                                    <option value="N">N</option>
                                    <option value="O">O</option>
                                    <option value="P">P</option>
                                    <option value="Q">Q</option>
                                    <option value="R">R</option>
                                    <option value="S">S</option>
                                    <option value="T">T</option>
                                    <option value="U">U</option>
                                    <option value="V">V</option>
                                    <option value="W">W</option>
                                    <option value="X">X</option>
                                    <option value="Y">Y</option>
                                    <option value="Z">Z</option>
                                </select>
                                <button type="submit" class="btn btn-danger btn-end "><i
                                        class="fas fa-search"></i></button>
                            </form>
                        </div>
                    </div>
                </div>

            </div>
            <div class="col-lg-6 col-md-6 col-sm-12">
                <div class="card" id="card-big">
                    <div class="card-body">
                        <h5 class="card-title mybluecolor text-center">Upcoming Tests</h5>

                        <div class="row" id="testDisplayArea">


                        </div>
                        <div class="col align-self-center text-center"></div>
                        <div class="col align-self-center text-center">
                            <a href="/test-archives"><button class="btn btn-danger btn-top-margin">All Test</button></a>
                        </div>
                        <div class="col align-self-end"></div>

                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-3 col-sm-12">
                <div class="col-lg-12 col-md-12 col-sm-12">
                    <div class="card mycard">
                        <div class="card-body">
                            <h5 class="card-title mybluecolor">
                                <div class="row">
                                    <div class="col self-align-start">New Test</div>
                                    <!-- <div class="col self-align-center"></div> -->
                                    <div class="col self-align-end">
                                        <button class="btn btn-danger btn-end btn-sm" data-bs-toggle="modal"
                                            data-bs-target="#newTest">
                                            <i class="fas fa-plus"></i>&nbsp<i class="far fa-edit"></i>
                                        </button>
                                    </div>
                                </div>
                            </h5>
                        </div>
                    </div>
                </div>
                <div class="col-lg-12 col-md-12 col-sm-12">
                    <div class="card mycard">
                        <div class="card-body">
                            <h5 class="card-title mybluecolor">New Requests</h5>
                            <h6 class="card-subtitle mb-2 text-muted">
                                <hr>
                            </h6>
                            <div class="row">
                                <div class="col align-self-center text-center">
                                    <h5 class="myorangecolor text-center user-select-none" id="count-requests"></h5>
                                </div>
                                <div class="col align-self-center text-center"></div>
                                <div class="col align-self-end">
                                    <a href="/view-student-requests" class="btn btn-danger btn-end" data-bs-toggle="tooltip"
                                        data-bs-placement="left" title="See all requests">
                                        View</i></a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>




        </div>



    </div>
    </div>




    <div class="modal fade" id="newTest" tabindex="-1">
        <div class="modal-dialog ">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title mycolor">New Test</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <!-- Form -->
                <form action="/test/add" method="post">
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-6">
                                <label for="class" class="form-label">Class</label>
                                <select class="form-select " id="class" name="class">
                                    <optgroup label="School">
                                        <option value="1">1</option>
                                        <option value="2">2</option>
                                        <option value="3">3</option>
                                        <option value="4">4</option>
                                        <option value="5">5</option>
                                        <option value="6">6</option>
                                        <option value="7">7</option>
                                        <option value="8">8</option>
                                        <option value="9">9</option>
                                        <option value="10">10</option>
                                        <option value="11">11</option>
                                        <option value="12">12</option>
                                    </optgroup>
                                    <optgroup label="Graduation">
                                        <option value="GY1">Graduation 1st Year</option>
                                        <option value="GY1S1">Graduation 1st Year 1st Semester</option>
                                        <option value="GY1S2">Graduation 1st Year 2nd Semester</option>
                                        <option value="GY2">Graduation 2nd Year</option>
                                        <option value="GY2S1">Graduation 2nd Year 1st Semester</option>
                                        <option value="GY2S2">Graduation 2nd Year 2nd Semester</option>
                                        <option value="GY3">Graduation 3rd Year</option>
                                        <option value="GY3S1">Graduation 3rd Year 1st Semester</option>
                                        <option value="GY3S2">Graduation 3rd Year 2nd Semester</option>
                                        <option value="GY4">Graduation 4th Year</option>
                                        <option value="GY4S1">Graduation 4th Year 1st Semester</option>
                                        <option value="GY4S2">Graduation 4th Year 2nd Semester</option>
                                        <option value="GY5">Graduation 5th Year</option>
                                        <option value="GY5S1">Graduation 5th Year 1st Semester</option>
                                        <option value="GY5S2">Graduation 5th Year 2nd Semester</option>
                                    </optgroup>
                                    <optgroup label="Post Graduation">
                                        <option value="PGY1">PG 1st Year</option>
                                        <option value="PGY1S1">PG 1st Year 1st Semester</option>
                                        <option value="PGY1S2">PG 1st Year 2nd Semester</option>
                                        <option value="PGY2">PG 2nd Year</option>
                                        <option value="PGY2S1">PG 2nd Year 1st Semester</option>
                                        <option value="PGY2S2">PG 2nd Year 2nd Semester</option>
                                        <option value="PGY3">PG 3rd Year</option>
                                        <option value="PGY3S1">PG 3rd Year 1st Semester</option>
                                        <option value="PGY3S2">PG 3rd Year 2nd Semester</option>
                                    </optgroup>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="section" class="form-label">Section</label>
                                <select class="form-select " id="section" name="section">
                                    <option value="all">Allow all sections</option>
                                    <optgroup label="Only One">
                                        <option value="A">A</option>
                                        <option value="B">B</option>
                                        <option value="C">C</option>
                                        <option value="D">D</option>
                                        <option value="E">E</option>
                                        <option value="F">F</option>
                                        <option value="G">G</option>
                                        <option value="H">H</option>
                                        <option value="I">I</option>
                                        <option value="J">J</option>
                                        <option value="K">K</option>
                                        <option value="L">L</option>
                                        <option value="M">M</option>
                                        <option value="N">N</option>
                                        <option value="O">O</option>
                                        <option value="P">P</option>
                                        <option value="Q">Q</option>
                                        <option value="R">R</option>
                                        <option value="S">S</option>
                                        <option value="T">T</option>
                                        <option value="U">U</option>
                                        <option value="V">V</option>
                                        <option value="W">W</option>
                                        <option value="X">X</option>
                                        <option value="Y">Y</option>
                                        <option value="Z">Z</option>
                                    </optgroup>
                                </select>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="startTime" class="form-label">Exam starts at </label>
                                <input type="datetime-local" class="form-control " id="startTime" name="startTime"
                                    required>
                            </div>
                            <div class="col-md-6">
                                <label for="subject" class="form-label">Subject</label>
                                <input type="textarea" name="subject" id="subject" class="form-control"
                                    autocomplete="off" required placeholder="Subject">
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="windowTime" class="form-label">Login Window Time </label>
                                <select class="form-select " id="windowTime" name="windowTime">
                                    <option value="10">10 minutes</option>
                                    <option value="20">20 minutes</option>
                                    <option value="30">30 minutes</option>
                                    <option value="45">45 minutes</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="duration" class="form-label">Total Exam Duration </label>
                                <select class="form-select " id="duration" name="duration">
                                    <option value="10">10 minutes</option>
                                    <option value="15">15 minutes</option>
                                    <option value="20">20 minutes</option>
                                    <option value="30">30 minutes</option>
                                    <option value="45">45 minutes</option>
                                    <option value="60">60 minutes</option>
                                </select>
                            </div>
                        </div>
                        <label for="description" class="form-label">Exam Description (Optional)</label>
                        <textarea name="description" id="description" rows=3 class="form-control mb-3"></textarea>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="finalCheck" required>
                            <label class="form-check-label" for="finalCheck">Above details are final</label>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn modal-btn-close" data-bs-dismiss="modal">Close</button>
                        <button type="submit" class="btn modal-btn">Submit</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <%- include("../partials/footer.ejs") %>
    <script>
        $("document").ready(function () {
            $.get("/test/get/upcoming", function (data, status) {
                if (!data.tests) {
                    $("#testDisplayArea").append('<h3 class="text-center user-select-none" style="color:gray;margin-top:2%;">'+ data.msg + '</h1>')
                }
                else {
                    var i = 0;
                    var tests = data.tests;
                    tests.sort(function (a, b) {
                        return a.startTime - b.startTime;
                    });
                    tests.forEach(test => {
                        if (i < 4) {
                            createTestBlock(test)
                            i++
                        }
                        else {
                            i++;
                        }
                    });
                }
            });
            $.get("/get-student-invitation-code", function (data, status) {
                $("#invititation-code").append(data.icode);
            })
            $.get("/count-student-requests", function (data, status) {
                $("#count-requests").append(data.count);
            })
        })

        function createTestBlock(test) {
            var block = '<div class="shadow-sm p-3 mb-1 bg-body position-relative border rounded-1 lh-base upcoming-test-block"><div class="row">';
            block += '<div class="col-lg-4 col-md-6 col-sm-6">Class : ' + test.class + '</div>';
            var section = test.section;
            if (section === "all") { section = "All" }
            block += '<div class="col-lg-4 col-md-6 col-sm-6">Section : ' + section + '</div>';
            block += '<div class="col-lg-4 col-md-6 col-sm-6">Subject : ' + test.subject + '</div>';
            var d = new Date(test.startTime); var date = d.getDate(); var month = d.getMonth()+1; var year = d.getFullYear();
            var hour = d.getHours(); var mins = d.getMinutes(); var x = " AM";
            if (date < 10) { date = "0" + date; }
            if (month < 10) { month = "0" + month; }
            if (hour > 12) { hour = hour - 12; x = " PM"; }
            if(hour==12 ) {x=" PM";}
            if (hour < 10) { hour = "0" + hour; }
            if (mins < 10) { mins = "0" + mins; }
            block += '<div class="col-lg-4 col-md-6 col-sm-6">Date : ' + date + '/' + month + '/' + year + '</div>';
            block += '<div class="col-lg-4 col-md-6 col-sm-6">Time : ' + hour + ' : ' + mins + x + '</div>';
            block += '<div class="col-lg-4 col-md-6 col-sm-6">';
            block += '<a href="/test/' + test._id + '" class="btn btn-outline-warning btn-sm stretched-link">Go to this Test</a></div></div></div>'
            $("#testDisplayArea").append(block);
        }
    </script>


